{% layout 'theme' %}

{% if customer %}
  <div class="wishlist-container">
    <h1>My Wishlist</h1>
    <div id="wishlist-products" class="wishlist-grid"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async function () {
      const customerId = "{{ customer.id }}";
      const wishlist = JSON.parse(localStorage.getItem(`wishlist_${customerId}`)) || [];
      const container = document.getElementById("wishlist-products");

      if (wishlist.length === 0) {
        container.innerHTML = "<p>Your wishlist is empty.</p>";
        return;
      }

      let html = "";

      for (const productId of wishlist) {
        try {
          const res = await fetch(`/products/${productId}.js`);
          const product = await res.json();

          html += `
            <div class="wishlist-item">
              <a href="/products/${product.handle}">
                <img src="${product.images[0]}" width="200" alt="${product.title}" />
                <h3>${product.title}</h3>
                <p>${Shopify.formatMoney(product.price)}</p>
              </a>
              <button onclick="removeFromWishlist('${product.id}')" class="remove-btn">Remove</button>
            </div>`;
        } catch (e) {
          console.error("Product not found:", productId);
        }
      }

      container.innerHTML = html;
    });

    function removeFromWishlist(productId) {
      const customerId = "{{ customer.id }}";
      let wishlist = JSON.parse(localStorage.getItem(`wishlist_${customerId}`)) || [];
      wishlist = wishlist.filter(id => id !== productId);
      localStorage.setItem(`wishlist_${customerId}`, JSON.stringify(wishlist));
      location.reload(); // Refresh to update UI
    }
  </script>
{% else %}
  <p>Please <a href="/account/login">log in</a> to view your wishlist.</p>
{% endif %}
